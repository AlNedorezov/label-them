/*! label-them 2017-04-18 */

function init(){resize()}function drawImg(a){var b=document.getElementById("main-canvas"),c=b.getContext("2d"),d=b.height*aspectRatio,e=(b.width-d)/2;c.drawImage(a,0,0,a.width,a.height,e,0,d,b.height)}function resize(){var a=document.getElementById("main-canvas"),b=(a.getContext("2d"),document.getElementById("canvas-parent")),c=document.getElementById("svg_img");b.style.minHeight=(b.clientWidth+28)/aspectRatio+"px";var d=b.clientHeight,e=b.clientWidth;a.style.height=d+"px",a.style.width=e+"px",a.width=e,a.height=d,c.style.width=e,c.style.height=d,drawImg(img)}function initCoordinates(a){svgImg=a}function getX(a){return a=a||window.event,a.pageX-svgImg.node.getBoundingClientRect().left}function getY(a){return a=a||window.event,a.pageY-svgImg.node.getBoundingClientRect().top}function getPoint(a){return{x:getX(a),y:getY(a),isFirst:!1}}function loadJSON(a){var b=new XMLHttpRequest;b.overrideMimeType("application/json"),b.open("GET",urlToJSONWithClassesAndParameters,!0),b.onreadystatechange=function(){4===b.readyState&&"200"==b.status&&a(b.responseText)},b.send(null)}function generateHTMLCodeForClassesAndParameters(a){loadJSON(function(b){var c=JSON.parse(b),d=[],e=[],f=[];if(e.push("<h4>"),e.push("Objects Classes"),e.push("</h4>"),e.push('<div class="dropdown">'),e.push('<button class="btn btn-default dropdown-toggle" type="button" '),e.push('id="dropdownMenu-Classes" '),e.push('data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">'),e.push("Objects Classes"),e.push('<span class="caret"></span>'),e.push("</button>"),e.push('<ul class="dropdown-menu" aria-labelledby="dropdownMenu-Classes">'),c.classes.forEach(function(a){e.push('<li><a role="menuitem" tabindex="-1" href="#">'),e.push(a),e.push("</a></li>")}),e.push("</ul>"),e.push("</div>"),e=e.join(""),null!==c.parameters){var g=0,h=0;f.push("</br>"),f.push("<h4>"),f.push("Objects Parameters"),f.push("</h4>"),f.push("<form>"),c.parameters.forEach(function(a){"boolean"===a.type?(f.push('<div class="checkbox">'),f.push('<label><input type="checkbox" value="">'),f.push(a.name),f.push("</label>"),f.push("</div>")):"string"===a.type?(h++,f.push('<div class="input-group">'),f.push('<span class="input-group-addon" id="basic-addon'),f.push(h),f.push('">'),f.push(a.prefix),f.push("</span>"),f.push('<input type="text" class="form-control" placeholder="'),f.push(a.name),f.push('" aria-describedby="basic-addon'),f.push(h),f.push('">'),f.push("</div>")):"select"===a.type&&(g++,f.push('<div class="dropdown">'),f.push('<button class="btn btn-default dropdown-toggle'),(h>0&&1===g||g>1)&&f.push(" dropdown-menu-parameters"),f.push('" type="button" '),f.push('id="dropdownMenu-parameters'),f.push(g),f.push('" '),f.push('data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">'),f.push(a.name),f.push('<span class="caret"></span>'),f.push("</button>"),f.push('<ul class="dropdown-menu" aria-labelledby="dropdownMenu-parameters'),f.push(g),f.push('">'),a.options.forEach(function(a){f.push('<li><a role="menuitem" tabindex="-1" href="#">'),f.push(a),f.push("</a></li>")}),f.push("</ul>"),f.push("</div>"))}),f.push("</form>"),f=f.join("")}d.push(e),d.push(f),d=d.join(""),a.getElementById("classes-and-parameters").innerHTML+=d})}function drawLine(a,b,c,d,e){svgImg.line(a.x,a.y,b.x,b.y).attr({fill:c,stroke:d,strokeWidth:e})}function drawCircle(a,b,c,d,e){svgImg.circle(a.x,a.y,b).attr({fill:c,stroke:d,strokeWidth:e})}function initNavMenu(){getElements(),setElementsOnClick()}function setElementsOnClick(){setOnClick(btnSave),setOnClick(btnHand),setOnClick(btnPolygon),setOnClick(btnEdit),setOnClick(btnZoomIn),setOnClick(btnZoomOut),setOnClick(btnBrightnessHigh),setOnClick(btnBrightnessLow)}function getElements(){btnSave=document.getElementById("btn_save"),btnHand=document.getElementById("btn_hand"),btnPolygon=document.getElementById("btn_polygon"),btnEdit=document.getElementById("btn_edit"),btnZoomIn=document.getElementById("btn_zoom_in"),btnZoomOut=document.getElementById("btn_zoom_out"),btnBrightnessHigh=document.getElementById("btn_brightness_high"),btnBrightnessLow=document.getElementById("btn_brightness_low")}function btnSaveFunc(a){}function btnHandFunc(a){}function clearOnClick(a){a.onclick=""}function btnPolygonFunc(a){a?svgImg.node.onclick=function(){svgImgOnClick(event)}:clearOnClick(svgImg.node.onclick)}function btnEditFunc(a){}function btnZoomInFunc(a){}function btnZoomOutFunc(a){}function btnBrightnessHighFunc(a){}function btnBrightnessLowFunc(a){}function setOnClick(a){a.onclick=function(){var b=!1;switch(isButtonSelected(a)&&(b=!0),a.id){case"btn_save":btnSaveFunc(b);break;case"btn_hand":btnHandFunc(b);break;case"btn_polygon":btnPolygonFunc(b);break;case"btn_edit":btnEditFunc(b);break;case"btn_zoom_in":btnZoomInFunc(b);break;case"btn_zoom_out":btnZoomOutFunc(b);break;case"btn_brightness_high":btnBrightnessHighFunc(b);break;case"btn_brightness_low":btnBrightnessLowFunc(b)}}}function isButtonSelected(a){return"rgb(27, 109, 133)"===a.style.background?(a.style.background="#ffffff",!1):(a.style.background="#1b6d85",!0)}function initSvg(a){messageSpace=document.getElementById("message_space"),svgImg=Snap("#svg_img"),initCoordinates(svgImg)}function svgImgOnClick(a){var b=getPoint(a);pointsList.push(b),draw()}function draw(){if(1===pointsList.length){var a=pointsList[0];a.isFirst=!0,drawDot(a)}else drawPolygon()}function drawPolygon(){var a=isPolygonClosed(pointsList[pointsList.length-1]);a&&(pointsList[pointsList.length-1]=pointsList[0]);for(var b=0;b<pointsList.length-1;b++)drawLine(pointsList[b],pointsList[b+1],"f44","#f44242",lineWidth);pointsList.forEach(function(a){drawDot(a)}),a&&(pointsList=[],showMessage())}function isPolygonClosed(a){var b=5*lineWidth,c=pointsList[0].x-b,d=pointsList[0].x+b,e=pointsList[0].y-b,f=pointsList[0].y+b;return a.x>=c&&a.x<=d&&a.y>=e&&a.y<=f}function drawDot(a){a.isFirst?drawCircle(a,circleRadius,"#bada55","#000000",strokeWidth):drawCircle(a,circleRadius,"#bada55","#ffffff",strokeWidth)}function showMessage(){$("#message_space").slideDown(1e3),setTimeout(function(){$("#message_space").slideUp(1e3)},3e3)}var img=new Image;img.src="https://actingmylife.files.wordpress.com/2015/06/img_1730.jpg";var aspectRatio=img.width/img.height;window.addEventListener("load",init,!1),window.addEventListener("resize",resize,!1);var svgImg,urlToJSONWithClassesAndParameters="https://rawgit.com/innosoft-pro/label-them/develop/front/json/classesandparameters.json",btnSave,btnHand,btnPolygon,btnEdit,btnZoomIn,btnZoomOut,btnBrightnessHigh,btnBrightnessLow,messageSpace,svgImg,pointsList=[],lineWidth=2,circleRadius=5,strokeWidth=5;